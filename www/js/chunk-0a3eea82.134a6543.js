(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a3eea82"],{"1c7d":function(t,e,s){},3588:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list-restart"},[s("div",{staticClass:"list-restart__container"},[s("div",{staticClass:"list-restart__table",class:{"is-long-list":t.list&&t.list.length>2}},[s("div",{staticClass:"list-restart__row table-row"},t._l(t.fields,(function(e,i){return s("div",{staticClass:"list-restart__title table-cell",class:{"col-05":e.isSmall,"col-1":e.isMedium,"col-2":!e.isSmall&&!e.isMedium}},[0===i?s("div",{staticClass:"list-restart__checkbox checkbox",class:{"is-active":t.allAreSelected,"is-disabled":!t.list||!t.list.length},on:{click:function(e){return t.onSelectAllClick()}}},[t._m(0,!0)]):s("div",{staticClass:"list-restart__title-wrapper",class:{"is-disabled":!t.list||!t.list.length},on:{click:function(e){return t.onTitleClick(i)}}},[s("div",{staticClass:"list-restart__title-text",domProps:{innerHTML:t._s(e.title)}}),s("div",{staticClass:"list-restart__title-sort"},[s("i",{staticClass:"list-restart__title-sort-icon el-icon-caret-top",class:{"is-active":t.list&&t.list.length&&t.listSortField===t.fields[i].field&&t.isAscSorted}}),s("i",{staticClass:"list-restart__title-sort-icon el-icon-caret-bottom",class:{"is-active":t.list&&t.list.length&&t.listSortField===t.fields[i].field&&t.isDescSorted}})])])])})),0),t.list&&t.list.length?s("div",{staticClass:"list-restart__body"},t._l(t.list,(function(e,i){return s("ItemRestart",{key:i,staticClass:"list-restart__item table-row",attrs:{section:e,fields:t.fields,isActive:t.namesSelected.indexOf(e.serviceName)>=0},on:{checkboxClicked:function(s){return t.onItemCheckboxClick(e.serviceName)}}})})),1):t._e()]),s("div",{staticClass:"list-restart__btns"},[s("ButtonApp",{directives:[{name:"show",rawName:"v-show",value:t.list&&t.list.length,expression:"list && list.length"}],staticClass:"list-restart__btn",attrs:{text:"Перезапустить",isDisabled:!t.namesSelected.length},on:{clicked:t.onRestartClick}}),s("ButtonApp",{staticClass:"list-restart__btn",attrs:{text:"Обновить список",btnType:"primaryText"},on:{clicked:t.onUpdateClick}})],1)])])},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"list-restart__checkbox-icon-wrapper checkbox-icon-wrapper"},[s("i",{staticClass:"list-restart__checkbox-icon el-icon-check checkbox-icon"})])}],c=s("9ab4"),r=s("60a3"),l=s("c91f"),n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"item-restart"},[s("div",{staticClass:"item-restart__info"},t._l(t.fields,(function(e,i){return s("div",{staticClass:"item-restart__cell table-cell",class:{"col-05":e.isSmall,"col-1":e.isMedium,"col-2":!e.isSmall&&!e.isMedium}},[0===i?s("div",{staticClass:"item-restart__checkbox checkbox",class:{"is-active":t.isActive,"is-hovered":t.checkboxIsHovered},on:{click:t.onCheckboxClick}},[t._m(0,!0)]):s("div",{staticClass:"item-restart__cell-content",domProps:{innerHTML:t._s(t.section[e.field])},on:{click:function(e){1===i&&t.onCheckboxClick()},mouseenter:function(e){return t.setCheckboxIsHovered(1===i)},mouseleave:function(e){return t.setCheckboxIsHovered(!1)}}})])})),0)])},o=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"item-restart__checkbox-icon-wrapper checkbox-icon-wrapper"},[s("i",{staticClass:"item-restart__checkbox-icon el-icon-check checkbox-icon"})])}],d=s("121b");let h=class extends r["e"]{constructor(){super(...arguments),this.descrIsShown=!1,this.checkboxIsHovered=!1}get cells(){return this.section&&[this.section.serviceName,this.section.replicas]}onCheckboxClick(){this.$emit("checkboxClicked")}setCheckboxIsHovered(t){this.checkboxIsHovered=t}};Object(c["a"])([Object(r["c"])()],h.prototype,"section",void 0),Object(c["a"])([Object(r["c"])()],h.prototype,"isActive",void 0),Object(c["a"])([Object(r["c"])()],h.prototype,"fields",void 0),h=Object(c["a"])([Object(r["a"])({components:{ButtonApp:d["a"]}})],h);var u=h,m=u,p=(s("84cf"),s("0c7c")),b=Object(p["a"])(m,n,o,!1,null,null,null),g=b.exports,f=s("8c15"),v=s("51a1"),S=s("521f"),k=s("dd23");const x=r["e"].extend({computed:{...k["b"].mapState(["breakpoint"])}}),_=r["e"].extend({computed:{...l["b"].mapState(["listSort"])},methods:{...l["b"].mapMutations(["updateListSort"]),...l["b"].mapActions(["editList"])}});let C=class extends(Object(r["b"])(x,_,v["a"],f["a"])){constructor(){super(...arguments),this.checkboxIsActive=!1,this.namesSelected=[]}get fields(){return[{field:null,title:"",isSmall:!0},{field:"serviceName",title:"Название"},{field:"replicas",title:this.isXs?"Кол-во реплик":"Количество реплик",isMedium:!0}]}get isXs(){return"xs"===this.breakpoint}get amountTotal(){return this.list&&this.list.length}get allAreSelected(){return this.namesSelected.length>0&&this.amountTotal===this.namesSelected.length}get allNames(){return this.list&&this.list.map(t=>t.serviceName)}get listSortField(){return this.listSort.by}get listSortDirection(){return this.listSort.direction}get isAscSorted(){return"asc"===this.listSortDirection}get isDescSorted(){return"desc"===this.listSortDirection}onIsActiveChange(t){this.resetSelect(),this.resetSort()}onSelectAllClick(){this.allAreSelected?this.namesSelected=[]:this.namesSelected=[...this.allNames]}onItemCheckboxClick(t){const e=this.namesSelected.indexOf(t),s=e>=0;s?this.namesSelected.splice(e,1):this.namesSelected.push(t)}resetSelect(){this.namesSelected=[],this.checkboxIsActive=!1}onTitleClick(t){const e=this.fields[t].field,s=e!==this.listSortField,i=s||"desc"===this.listSortDirection?"asc":"desc",a={by:e,direction:i};this.updateListSort(a)}resetSort(){const t={by:"serviceName",direction:"asc"};this.updateListSort(t)}onRestartClick(){const t=[];for(const e of this.namesSelected)t.push({serviceName:e});this.$emit("editClicked",t)}onUpdateClick(){this.$emit("updateClicked")}};Object(c["a"])([Object(r["c"])()],C.prototype,"list",void 0),Object(c["a"])([Object(r["f"])("isActive",{immediate:!0})],C.prototype,"onIsActiveChange",null),C=Object(c["a"])([Object(r["a"])({components:{ItemRestart:g,ButtonApp:d["a"],MessageBox:S["a"]}})],C);var L=C,B=L,w=(s("68fc"),Object(p["a"])(B,i,a,!1,null,"1cddd7e9",null));e["a"]=w.exports},"68fc":function(t,e,s){"use strict";var i=s("dbe7"),a=s.n(i);a.a},"7b18":function(t,e,s){"use strict";s.r(e);var i=s("c91f"),a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"page-main page"},[s("div",{staticClass:"page-main__container"},[s("ListRestart",{key:t.listSorted+t.editPayload,staticClass:"page-main__list",attrs:{list:t.listSorted},on:{editClicked:t.onEditClick,updateClicked:t.onUpdateClick}})],1),s("transition",[s("MessageBox",{directives:[{name:"show",rawName:"v-show",value:t.msgBoxIsShown&&t.editFailed,expression:"msgBoxIsShown && editFailed"}],staticClass:"list-features__msg-box modal modal-msg",attrs:{content:t.msgBoxContent},on:{close:t.closeMsgBox,firstBtnClicked:t.onFirstBtnClick,secondBtnClicked:t.closeMsgBox}})],1)],1)},c=[],r=s("9ab4"),l=s("60a3"),n=s("121b"),o=s("521f"),d=s("51a1"),h=s("8c15"),u=s("3588");const m=l["e"].extend({computed:{...i["b"].mapState(["list"]),...i["b"].mapGetters(["isLoading","listSorted"])},methods:{...i["b"].mapActions(["editList"])}});let p=class extends(Object(l["b"])(h["a"],d["a"],m)){constructor(){super(...arguments),this.editPayload=null}get editFailed(){return"failEdit"===this.requestStatus}onEditClick(t){t&&(this.editPayload=t),this.editList(this.editPayload).then(()=>{this.editPayload=null}).catch(()=>{this.requestStatus="failEdit",this.openMsgBox()})}onUpdateClick(){this.$emit("updateList")}onFirstBtnClick(){switch(this.closeMsgBox(),this.requestStatus){case"failEdit":this.onEditClick();break}}};p=Object(r["a"])([Object(l["a"])({components:{MessageBox:o["a"],ButtonApp:n["a"],ListRestart:u["a"]},mixins:[h["a"]]})],p);var b=p,g=b,f=(s("7cf7"),s("0c7c")),v=Object(f["a"])(g,a,c,!1,null,"83c7d872",null),S=v.exports;const k=[{path:"/",component:S,name:"PageRestart"},{path:"*",redirect:{name:"PageRestart"}}];var x=[{path:"/restart",component:()=>s.e("restart").then(s.bind(null,"2d6d")),name:"ModuleRestart",redirect:{name:"PageRestart"},children:k,meta:{title:"Рестарт сервисов",isDynamicModule:!0}}];e["default"]={name:"restart",store:i["a"],routes:x}},"7cf7":function(t,e,s){"use strict";var i=s("1c7d"),a=s.n(i);a.a},8073:function(t,e,s){},"84cf":function(t,e,s){"use strict";var i=s("8073"),a=s.n(i);a.a},"8c15":function(t,e,s){"use strict";var i=s("9ab4"),a=s("2b0e"),c=s("3653"),r=s("c91f"),l=s("51a1");const n=a["default"].extend({computed:{...r["b"].mapGetters(["loadingError"])}});let o=class extends(Object(c["Mixins"])(n,l["a"])){constructor(){super(...arguments),this.requestStatus="failFetchList",this.titles={success:"Готово!",fail:"Ошибка!"},this.statuses={success:["successFetchList","successEdit"],fail:["failFetchList","failEdit"]},this.btns={successFetchList:{firstBtn:"Закрыть"},successEdit:{firstBtn:"Закрыть"},failFetchList:{firstBtn:"Повторить попытку",secondBtn:"К списку разделов"},failEdit:{firstBtn:"Повторить попытку",secondBtn:"Отмена"}}}get statusType(){for(const t in this.statuses)if(this.statuses[t].indexOf(this.requestStatus)>=0)return t}get msgBoxTitle(){return this.titles[this.statusType]}get msgBoxMsg(){return this.loadingError}get msgBoxBtns(){return this.btns[this.requestStatus]}get msgBoxContent(){return{title:this.msgBoxTitle,msg:this.msgBoxMsg||this.contentDefault,...this.msgBoxBtns}}};o=Object(i["a"])([c["Mixin"]],o),e["a"]=o},c91f:function(t,e,s){"use strict";(function(t){s.d(e,"a",(function(){return h})),s.d(e,"b",(function(){return u}));var i=s("e738"),a=s("675f");const c=!0,r=t&&Object({NODE_ENV:"production",BASE_URL:"/"})&&!1;class l{constructor(){this.edit={error:null,isLoading:!1},this.hashes=["active","inactive"],this.list={data:null,error:null,isLoading:!1},this.listSort={by:"serviceName",direction:"asc"}}}class n extends a["b"]{get isLoading(){return this.state.list.isLoading||this.state.edit.isLoading}get loadingError(){return this.state.list.error||this.state.edit.error}get listSorted(){if(!this.state.list.data||!this.state.list.data.length)return;const t=[...this.state.list.data],e=this.state.listSort.by,s=this.state.listSort.direction;return t.sort((t,i)=>{let a=t[e],c=i[e];switch(e){case"serviceName":a=a.toString().toLowerCase(),c=c.toString().toLowerCase();break;case"replicas":a=Number(a),c=Number(c);break}return a>c&&"asc"===s||a<c&&"desc"===s?1:-1})}}class o extends a["d"]{updateListSort(t){this.state.listSort.by=t.by,this.state.listSort.direction=t.direction}startListLoading(){this.state.list.isLoading=!0,this.state.list.error=null}setListLoadingSuccess(t){this.state.list.data=t,this.state.list.isLoading=!1,this.state.list.error=null}setListLoadingFail(t){this.state.list.data=null,this.state.list.isLoading=!1,this.state.list.error=t}startEdit(){this.state.edit.error=null,this.state.edit.isLoading=!0}setEditSuccess(t){this.state.list.data=t,this.state.edit.error=null,this.state.edit.isLoading=!1}setEditFail(t){this.state.edit.error=t,this.state.edit.isLoading=!1}}class d extends a["a"]{async getList(){return new Promise((t,e)=>{this.commit("startListLoading"),i["a"].get("/api/v1/services-list").then(e=>{while(e&&!Array.isArray(e))e=e.data;this.commit("setListLoadingSuccess",e),r&&console.log("Success: load list"),t()}).catch(t=>{const s=t&&t.response&&t.response.data&&t.response.data.message||null;this.commit("setListLoadingFail",s),t&&t.response?e(t.response):e()})})}async editList(t){return new Promise((e,s)=>{this.commit("startEdit"),i["a"].post("/api/v1/services",t).then(async t=>{r&&console.log("Success: edit list");while(t&&!Array.isArray(t))t=t.data;this.commit("setEditSuccess",t),e()}).catch(t=>{r&&t&&t.response?console.log(t.response):console.log("error");const e=t&&t.response&&t.response.data&&t.response.data.message||null;this.commit("setEditFail",e),s()})})}}const h=new a["c"]({namespaced:c,state:l,getters:n,mutations:o,actions:d}),u=Object(a["e"])(h)}).call(this,s("4362"))},dbe7:function(t,e,s){}}]);
//# sourceMappingURL=chunk-0a3eea82.134a6543.js.map